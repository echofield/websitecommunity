<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur de Projet - par [Nom de votre Écosystème]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #FAFAFA; --foreground: #18181B; --muted: #52525B;
            --accent: #4F46E5; --accent-soft: #4f46e533; --border: #E4E4E7; --card-bg: #FFFFFF;
        }
        body { background-color: var(--background); color: var(--foreground); font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .font-mono { font-family: 'IBM Plex Mono', monospace; }
        .hero-section::before { content: ''; position: absolute; top: 50%; left: 50%; width: min(100vw, 1200px); height: min(100vh, 1200px); transform: translate(-50%, -50%); background: radial-gradient(circle, var(--accent-soft) 0%, rgba(250,250,250,0) 60%); z-index: -1; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem; border: 1px solid var(--border); padding: 12px 28px; font-size: 1rem; font-weight: 500; border-radius: 999px; color: var(--foreground); background-color: var(--card-bg); transition: all 0.3s ease; text-decoration: none; cursor: pointer; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .btn:hover { border-color: var(--muted); transform: translateY(-1px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .btn-primary { background: var(--accent); border-color: var(--accent); color: #FFFFFF; font-weight: 600; }
        .btn-primary:hover { background-color: #4338CA; border-color: #4338CA; }
        .btn-lg { padding: 16px 40px; font-size: 1.125rem; }
        .form-group { opacity: 0; visibility: hidden; position: absolute; width: 100%; transition: opacity 0.4s ease-in-out, visibility 0.4s; }
        .form-group.active { opacity: 1; visibility: visible; position: relative; animation: slideInUp 0.5s ease-out; }
        @keyframes slideInUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        .form-input, textarea.form-input { width: 100%; padding: 14px; margin-bottom: 1rem; border: 1px solid var(--border); border-radius: 8px; background-color: var(--card-bg); color: var(--foreground); font-size: 1rem; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
        .form-input:focus, textarea.form-input:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-soft); }
        .form-radio:checked + label { border-color: var(--accent); background-color: var(--accent-soft); color: var(--foreground); font-weight: 600; box-shadow: 0 0 0 2px var(--accent); }
        .form-label { display: block; font-size: 1.5rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--foreground); }
        .result-container { background: var(--card-bg); border-radius: 16px; padding: 2.5rem; max-width: 800px; margin: 2rem auto; box-shadow: 0 4px 25px rgba(0,0,0,0.05); text-align: left; border: 1px solid var(--border); }
    </style>
</head>
<body class="overflow-x-hidden">

    <div id="page-wrapper">
        <header class="py-6 text-center">
            <h2 class="font-mono text-lg font-bold">[Nom de votre Écosystème]</h2>
        </header>
        <main class="container mx-auto px-6">
            <section id="intro-section" class="hero-section min-h-[80vh] flex flex-col items-center justify-center text-center py-20 relative">
                <div class="max-w-3xl">
                    <h1 class="text-4xl md:text-6xl font-bold text-foreground tracking-tighter">Votre projet web mérite plus qu'un simple devis.</h1>
                    <div class="mt-8 text-lg text-muted max-w-2xl mx-auto space-y-4">
                        <p>Notre simulateur intelligent analyse votre besoin en 2 minutes pour générer un brief de projet clair, et vous faire découvrir comment notre écosystème de membres développeurs et d'outils de pointe peut donner vie à votre vision.</p>
                    </div>
                    <div class="mt-12">
                        <a href="#funnel-section" class="btn btn-primary btn-lg">Lancer ma Simulation</a>
                    </div>
                </div>
            </section>

            <section id="funnel-section" class="min-h-screen flex items-center justify-center py-20">
                <div id="funnel-container" class="w-full max-w-2xl"></div>
            </section>
        </main>
    </div>
    
    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            const funnelContainer = document.getElementById('funnel-container');
            let currentStep = 0;
            
            const questions = [
                { id: 'project_type', type: 'radio', prompt: "Pour commencer, quel type de projet envisagez-vous ?", options: ['Site Vitrine (présentation)', 'E-commerce (vente en ligne)', 'Application Web / SaaS', 'Blog / Média', 'Autre'] },
                { id: 'main_goal', type: 'radio', prompt: "Quel est l'objectif N°1 de ce projet ?", options: ['Générer des prospects / contacts', 'Vendre des produits ou services', 'Automatiser une tâche / un processus', 'Construire une audience'] },
                { id: 'budget_range', type: 'radio', prompt: "Quelle est votre fourchette budgétaire ?", options: ['< 2 000 €', '2 000 € - 5 000 €', '5 000 € - 10 000 €', '> 10 000 €'] },
                { id: 'name', type: 'text', prompt: "Parfait. Comment pouvons-nous vous appeler ?" },
                { id: 'email', type: 'text', prompt: "Et votre email, pour recevoir la simulation ?" }
            ];
            const totalSteps = questions.length;

            function renderForm() {
                const formGroupsHtml = questions.map((q, index) => {
                    let groupContent = '';
                    if (q.type === 'text') {
                        groupContent = `
                            <label for="q-${q.id}" class="form-label">${q.prompt}</label>
                            <input type="${q.id === 'email' ? 'email' : 'text'}" id="q-${q.id}" name="${q.id}" required class="form-input" placeholder="Votre réponse...">`;
                    } else if (q.type === 'radio') {
                        const optionsHtml = q.options.map((opt, i) => `
                            <div>
                                <input type="radio" name="${q.id}" id="${q.id}-${i}" value="${opt}" class="hidden form-radio" required>
                                <label for="${q.id}-${i}" class="block w-full cursor-pointer bg-card-bg border-2 border-border rounded-lg p-4 text-lg text-center text-foreground hover:border-accent transition-colors duration-200">${opt}</label>
                            </div>`).join('');
                        groupContent = `<label class="form-label text-center">${q.prompt}</label><div class="grid grid-cols-1 md:grid-cols-2 gap-4">${optionsHtml}</div>`;
                    }
                    return `<div class="form-group text-center ${index === 0 ? 'active' : ''}" data-step="${index}">${groupContent}</div>`;
                }).join('');

                const formHtml = `
                    <form id="audit-form" class="relative min-h-[400px]">${formGroupsHtml}</form>
                    <div id="form-navigation" class="mt-8 flex justify-between items-center">
                        <button type="button" id="prev-btn" class="btn" style="display: none;">← Retour</button>
                        <span id="progress-indicator" class="font-mono text-muted">${currentStep + 1} / ${totalSteps}</span>
                        <button type="button" id="next-btn" class="btn btn-primary">Suivant →</button>
                    </div>`;
                funnelContainer.innerHTML = formHtml;
                addFormEventListeners();
            }

            function updateFormView() {
                document.querySelectorAll('.form-group').forEach((group, index) => group.classList.toggle('active', index === currentStep));
                document.getElementById('progress-indicator').textContent = `${currentStep + 1} / ${totalSteps}`;
                document.getElementById('prev-btn').style.display = currentStep > 0 ? 'inline-flex' : 'none';
                const nextBtn = document.getElementById('next-btn');
                if (nextBtn) nextBtn.textContent = currentStep === totalSteps - 1 ? 'Générer ma Simulation →' : 'Suivant →';
            }

            function handleNext() {
                const currentGroup = document.querySelector(`.form-group[data-step="${currentStep}"]`);
                const input = currentGroup.querySelector('input[required]');
                let isValid = true;
                if (input.type === 'radio') {
                    if (!document.querySelector(`input[name="${input.name}"]:checked`)) isValid = false;
                } else {
                    if (!input.value.trim() || (input.type === 'email' && !/^\S+@\S+\.\S+$/.test(input.value))) isValid = false;
                }
                if (!isValid) {
                    currentGroup.style.animation = 'shake 0.3s';
                    setTimeout(() => currentGroup.style.animation = '', 300);
                    return;
                }
                if (currentStep < totalSteps - 1) { currentStep++; updateFormView(); } 
                else { handleFinalSubmit(); }
            }

            function addFormEventListeners() {
                document.getElementById('next-btn')?.addEventListener('click', handleNext);
                document.getElementById('prev-btn')?.addEventListener('click', () => { if (currentStep > 0) currentStep--; updateFormView(); });
                document.querySelectorAll('input[type="text"], input[type="email"]').forEach(input => input.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); handleNext(); }}));
                document.querySelectorAll('input[type="radio"]').forEach(radio => radio.addEventListener('change', () => setTimeout(handleNext, 250)));
            }
            
            async function handleFinalSubmit() {
                const form = document.getElementById('audit-form');
                const userAnswers = Object.fromEntries(new FormData(form).entries());
                funnelContainer.innerHTML = `<div class="text-center font-mono text-muted py-20">Analyse en cours...</div>`;
                
                try {
                    const apiURL = `/api/generate-project-brief`;
                    const response = await fetch(apiURL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(userAnswers)
                    });
                    if (!response.ok) throw new Error(`API error: ${response.status}`);
                    const result = await response.json();
                    showAIResults(result.briefHtml);
                } catch (error) {
                    console.error("Submission error:", error);
                    funnelContainer.innerHTML = `<div class="text-center p-8"><h3 class="text-2xl font-bold text-red-600">ERREUR</h3><p class="text-lg text-gray-600 mt-4">Impossible de générer votre simulation. Veuillez réessayer.</p></div>`;
                }
            }
            
            function showAIResults(resultHtml) {
                const finalHtml = `
                    <div class="result-container animate-slideInUp">${resultHtml}</div>
                    <div class="text-center mt-12">
                         <button onclick="window.location.reload();" class="btn">Lancer une nouvelle simulation</button>
                    </div>`;
                funnelContainer.innerHTML = finalHtml;
            }

            renderForm();
            document.querySelector("#start-audit-btn").addEventListener("click", function(e) {
                e.preventDefault();
                document.querySelector(this.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
